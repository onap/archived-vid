///<reference path="../../../node_modules/cypress/types/index.d.ts"/>
describe('Template', () => {

  beforeEach(() => {
    cy.clearSessionStorage();
    cy.setReduxState();
    cy.preventErrorsOnLoading();
    cy.initAAIMock();
    cy.initVidMock();
    cy.login();
  });

  afterEach(() => {
    cy.screenshot();
  });

  it('when open service popup should show template button', function () {
    cy.readFile('cypress/support/jsonBuilders/mocks/jsons/flags.cypress.json').then((flags) => {
      cy.server()
        .route({
          method: 'GET',
          delay: 0,
          status: 200,
          url: Cypress.config('baseUrl') + "/flags**",
          response: {
            "FLAG_VF_MODULE_RESUME_STATUS_CREATE": false,
            "FLAG_2002_INSTANTIATION_TEMPLATES": true
          }
        }).as('initFlags');
    });

    const asyncInstantiation = [
      {
        "id": 8,
        "created": 1525075968000,
        "modified": 1525075971000,
        "action": "INSTANTIATE",
        "createdId": null,
        "modifiedId": null,
        "rowNum": null,
        "auditUserId": null,
        "auditTrail": null,
        "jobId": "5c2cd8e5-27d0-42e3-85a1-85db5eaba459",
        "templateId": "d42ba7c8-9e19-4e34-ae2c-d8af3f24498e",
        "userId": "16807000",
        "aLaCarte": false,
        "msoRequestId": "c0011670-0e1a-4b74-945d-8bf5aede1d9c",
        "jobStatus": "FAILED",
        "statusModifiedDate": 1525075968000,
        "hidden": false,
        "pause": false,
        "owningEntityId": "d61e6f2d-12fa-4cc2-91df-7c244011d6fc",
        "owningEntityName": "WayneHolland",
        "project": "WATKINS",
        "aicZoneId": "NFT1",
        "aicZoneName": "NFTJSSSS-NFT1",
        "tenantId": "bae71557c5bb4d5aac6743a4e5f1d054",
        "tenantName": "AIN Web Tool-15-D-testalexandria",
        "regionId": "hvf6",
        "regionName": null,
        "serviceType": "TYLER SILVIA",
        "subscriberName": "e433710f-9217-458d-a79d-1c7aff376d89",
        "serviceInstanceId": null,
        "serviceInstanceName": "nWUfl instance name_002",
        "serviceModelId": "e49fbd11-e60c-4a8e-b4bf-30fbe8f4fcc0",
        "serviceModelName": "action-data",
        "serviceModelVersion": "1.0",
        "createdBulkDate": 1525075968000,
        "isRetryEnabled": true
      },
      {
        "id": 7,
        "created": 1525075968000,
        "modified": 1525075971000,
        "action": "INSTANTIATE",
        "createdId": null,
        "modifiedId": null,
        "rowNum": null,
        "auditUserId": null,
        "auditTrail": null,
        "jobId": "13063a83-924e-4500-a3a1-e53d1b58450b",
        "templateId": "d42ba7c8-9e19-4e34-ae2c-d8af3f24498e",
        "userId": "16807000",
        "aLaCarte": false,
        "msoRequestId": "c0011670-0e1a-4b74-945d-8bf5aede1d9d",
        "jobStatus": "IN_PROGRESS",
        "statusModifiedDate": 1525075968000,
        "hidden": false,
        "pause": false,
        "owningEntityId": "d61e6f2d-12fa-4cc2-91df-7c244011d6fc",
        "owningEntityName": "WayneHolland",
        "project": "WATKINS",
        "aicZoneId": "NFT1",
        "aicZoneName": "NFTJSSSS-NFT1",
        "tenantId": "bae71557c5bb4d5aac6743a4e5f1d054",
        "tenantName": "AIN Web Tool-15-D-testalexandria",
        "regionId": "hvf6",
        "regionName": null,
        "serviceType": "TYLER SILVIA",
        "subscriberName": "e433710f-9217-458d-a79d-1c7aff376d89",
        "serviceInstanceId": null,
        "serviceInstanceName": "nWUfl instance name_001",
        "serviceModelId": "e49fbd11-e60c-4a8e-b4bf-30fbe8f4fcc0",
        "serviceModelName": "action-data",
        "serviceModelVersion": "1.0",
        "createdBulkDate": 1525075968000,
        "isRetryEnabled": false
      },
      {
        "id": 2325,
        "created": 1564412293000,
        "modified": 1564412330000,
        "createdId": null,
        "modifiedId": null,
        "rowNum": null,
        "auditUserId": null,
        "auditTrail": null,
        "jobId": "602c353c-660d-4253-b3c7-c76e2b2746e1",
        "templateId": "9df7d0ce-8579-4c6a-a4d8-0f43663e751c",
        "userId": "by5924",
        "msoRequestId": "198ef9d5-02ae-4fff-94e6-cc103ab287df",
        "jobStatus": "COMPLETED_WITH_NO_ACTION",
        "statusModifiedDate": 1564412330000,
        "hidden": false,
        "pause": false,
        "deletedAt": null,
        "owningEntityId": "10c645f5-9924-4b89-bec0-b17cf49d3cad",
        "owningEntityName": "WayneHolland",
        "project": "WATKINS",
        "aicZoneId": null,
        "aicZoneName": null,
        "tenantId": null,
        "tenantName": null,
        "regionId": null,
        "regionName": null,
        "serviceType": "TYLER SILVIA",
        "subscriberName": "e433710f-9217-458d-a79d-1c7aff376d89",
        "subscriberId": "a9a77d5a-123e-4ca2-9eb9-0b015d2ee0fb",
        "serviceInstanceId": "70320ad3-a423-4e3d-b259-c728e1e9f9c8",
        "serviceInstanceName": "instance name _ 005",
        "serviceModelId": "76450af1-6768-4fbb-9399-9c6705327efd",
        "serviceModelName": "network",
        "serviceModelVersion": "2.0",
        "createdBulkDate": 1564412293000,
        "action": "UPGRADE",
        "isRetryEnabled": false,
        "aLaCarte": true
      },
      {
        "id": 6,
        "created": 1525007432000,
        "modified": 1525007434000,
        "action": "INSTANTIATE",
        "createdId": null,
        "modifiedId": null,
        "rowNum": null,
        "auditUserId": null,
        "auditTrail": null,
        "jobId": "e1db03c3-6274-4ff7-84cf-7bd3a3946de7",
        "templateId": "cad41760-8653-4c5a-a5fd-8ee34780ae69",
        "userId": "16807000",
        "aLaCarte": false,
        "msoRequestId": "c0011670-0e1a-4b74-945d-8bf5aede1d8e",
        "jobStatus": "FAILED",
        "statusModifiedDate": 1525007432000,
        "hidden": false,
        "pause": false,
        "owningEntityId": "someID",
        "owningEntityName": "expected-owningEntityName",
        "project": "a-project-name57322c07-bb83-4e9a-9ef2-8fd53c4dd012",
        "aicZoneId": null,
        "aicZoneName": null,
        "tenantId": "greatTenant",
        "tenantName": null,
        "regionId": "my-expected-region-id",
        "regionName": null,
        "serviceType": "mySubType",
        "subscriberName": "ac040e8a-b43a-441b-ab87-603f5b70be55",
        "serviceInstanceId": null,
        "serviceInstanceName": "MichaelJordan_01",
        "serviceModelId": "300adb1e-9b0c-4d52-bfb5-fa5393c4eabb",
        "serviceModelName": "AIM_TRANSPORT_00004",
        "serviceModelVersion": "1.0",
        "createdBulkDate": 1525007432000,
        "isRetryEnabled": false
      },
      {
        "id": 5,
        "created": 1524995555000,
        "modified": 1524995556000,
        "action": "INSTANTIATE",
        "createdId": null,
        "modifiedId": null,
        "rowNum": null,
        "auditUserId": null,
        "auditTrail": null,
        "jobId": "9f88fdb5-bb47-4bf3-8c5f-98f1ad0ec87c",
        "templateId": "ce4ec177-cfc8-483e-8a2c-b7aea53fd740",
        "userId": "16807000",
        "msoRequestId": "c0011670-0e1a-4b74-945d-8bf5aede1d91",
        "requestId": null,
        "jobStatus": "FAILED",
        "statusModifiedDate": 1524995555000,
        "hidden": false,
        "pause": false,
        "owningEntityId": "aaa1",
        "owningEntityName": "aaa1",
        "project": "WATKINS",
        "aicZoneId": "BAN1",
        "aicZoneName": "VSDKYUTP-BAN1",
        "tenantId": "1178612d2b394be4834ad77f567c0af2",
        "tenantName": "AIN Web Tool-15-D-SSPtestcustome",
        "regionId": "hvf6",
        "regionName": null,
        "serviceType": "TYLER SILVIA",
        "subscriberName": "e433710f-9217-458d-a79d-1c7aff376d89",
        "serviceInstanceId": null,
        "serviceInstanceName": null,
        "serviceModelId": "e49fbd11-e60c-4a8e-b4bf-30fbe8f4fcc0",
        "serviceModelName": "ComplexService",
        "serviceModelVersion": "1.0",
        "createdBulkDate": 1524995555000,
        "isRetryEnabled": false
      },
      {
        "id": 4,
        "created": 1524994349000,
        "modified": 1524994350000,
        "action": "INSTANTIATE",
        "createdId": null,
        "modifiedId": null,
        "rowNum": null,
        "auditUserId": null,
        "auditTrail": null,
        "jobId": "b73b1543-fa12-4ad5-8ef5-49f02eb33698",
        "templateId": "79af00c6-4712-432a-8989-b6419c8baa40",
        "userId": "16807000",
        "aLaCarte": true,
        "msoRequestId": "c0011670-0e1a-4b74-945d-8bf5aede1d94",
        "jobStatus": "FAILED",
        "statusModifiedDate": 1524994349000,
        "hidden": false,
        "pause": false,
        "owningEntityId": "aaa1",
        "owningEntityName": "aaa1",
        "project": "WATKINS",
        "aicZoneId": null,
        "aicZoneName": null,
        "tenantId": "229bcdc6eaeb4ca59d55221141d01f8e",
        "tenantName": "AIN Web Tool-15-D-STTest2",
        "regionId": "hvf6",
        "regionName": null,
        "serviceType": "TYLER SILVIA",
        "subscriberName": "e433710f-9217-458d-a79d-1c7aff376d89",
        "serviceInstanceId": null,
        "serviceInstanceName": null,
        "serviceModelId": "e49fbd11-e60c-4a8e-b4bf-30fbe8f4fcc0",
        "serviceModelName": "ComplexService",
        "serviceModelVersion": "1.0",
        "createdBulkDate": 1524994349000,
        "isRetryEnabled": false
      },
      {
        "id": 3,
        "created": 1524991828000,
        "modified": 1524991830000,
        "action": "INSTANTIATE",
        "createdId": null,
        "modifiedId": null,
        "rowNum": null,
        "auditUserId": null,
        "auditTrail": null,
        "jobId": "725ef127-4ee5-4665-bdf1-55ee342b362f",
        "templateId": "6bd53c0d-8742-43f6-9ed2-efbb87062779",
        "userId": "16807000",
        "aLaCarte": true,
        "msoRequestId": "c0011670-0e1a-4b74-945d-8bf5aede1d96",
        "jobStatus": "FAILED",
        "statusModifiedDate": 1524991828000,
        "hidden": false,
        "pause": false,
        "owningEntityId": "aaa1",
        "owningEntityName": "aaa1",
        "project": "WATKINS",
        "aicZoneId": "NFT1",
        "aicZoneName": "NFTJSSSS-NFT1",
        "tenantId": "092eb9e8e4b7412e8787dd091bc58e86",
        "tenantName": "USP-SIP-IC-24335-T-01",
        "regionId": "AAIAIC25",
        "regionName": null,
        "serviceType": "TYLER SILVIA",
        "subscriberName": "e433710f-9217-458d-a79d-1c7aff376d89",
        "serviceInstanceId": null,
        "serviceInstanceName": null,
        "serviceModelId": "e49fbd11-e60c-4a8e-b4bf-30fbe8f4fcc0",
        "serviceModelName": "ComplexService",
        "serviceModelVersion": "1.0",
        "createdBulkDate": 1524991828000,
        "isRetryEnabled": false
      },
      {
        "id": 2,
        "created": 1524663233000,
        "modified": 1524663236000,
        "action": "INSTANTIATE",
        "createdId": null,
        "modifiedId": null,
        "rowNum": null,
        "auditUserId": null,
        "auditTrail": null,
        "jobId": "b1ff271b-829a-43f9-a2e3-23987a34f261",
        "templateId": "262fccc5-cae9-4258-b522-540c4010e0a9",
        "userId": "16807000",
        "aLaCarte": true,
        "msoRequestId": "c0011670-0e1a-4b74-945d-8bf5aede1d98",
        "jobStatus": "FAILED",
        "statusModifiedDate": 1524663233000,
        "hidden": false,
        "pause": false,
        "owningEntityId": "d61e6f2d-12fa-4cc2-91df-7c244011d6fc",
        "owningEntityName": "WayneHolland",
        "project": "WATKINS",
        "aicZoneId": "NFT1",
        "aicZoneName": "NFTJSSSS-NFT1",
        "tenantId": "bae71557c5bb4d5aac6743a4e5f1d054",
        "tenantName": "AIN Web Tool-15-D-testalexandria",
        "regionId": "hvf6",
        "regionName": null,
        "serviceType": "TYLER SILVIA",
        "subscriberName": "e433710f-9217-458d-a79d-1c7aff376d89",
        "serviceInstanceId": null,
        "serviceInstanceName": "sPenLiZXXpqzsVck instance name_02",
        "serviceModelId": "e49fbd11-e60c-4a8e-b4bf-30fbe8f4fcc0",
        "serviceModelName": "action-data",
        "serviceModelVersion": "1.0",
        "createdBulkDate": 1524663233000,
        "isRetryEnabled": true
      },
      {
        "id": 1,
        "created": 1524663233000,
        "modified": 1524663236000,
        "action": "INSTANTIATE",
        "createdId": null,
        "modifiedId": null,
        "rowNum": null,
        "auditUserId": null,
        "auditTrail": null,
        "jobId": "850dc7d2-5240-437f-9bcd-b1ed7dc339ca",
        "templateId": "262fccc5-cae9-4258-b522-540c4010e0a9",
        "userId": "16807000",
        "aLaCarte": true,
        "msoRequestId": "c0011670-0e1a-4b74-945d-8bf5aede1d45",
        "jobStatus": "IN_PROGRESS",
        "statusModifiedDate": 1524663233000,
        "hidden": false,
        "pause": false,
        "owningEntityId": "d61e6f2d-12fa-4cc2-91df-7c244011d6fc",
        "owningEntityName": "WayneHolland",
        "project": "WATKINS",
        "aicZoneId": "NFT1",
        "aicZoneName": "NFTJSSSS-NFT1",
        "tenantId": "bae71557c5bb4d5aac6743a4e5f1d054",
        "tenantName": "AIN Web Tool-15-D-testalexandria",
        "regionId": "hvf6",
        "regionName": null,
        "serviceType": "TYLER SILVIA",
        "subscriberName": "e433710f-9217-458d-a79d-1c7aff376d89",
        "serviceInstanceId": null,
        "serviceInstanceName": "sPenLiZXXpqzsVck instance name_01",
        "serviceModelId": "e49fbd11-e60c-4a8e-b4bf-30fbe8f4fcc0",
        "serviceModelName": "action-data",
        "serviceModelVersion": "1.0",
        "createdBulkDate": 1524663233000,
        "isRetryEnabled": false
      },
      {
        "id": 9,
        "created": 1524663233000,
        "modified": 1524663236000,
        "action": "DELETE",
        "createdId": null,
        "modifiedId": null,
        "rowNum": null,
        "auditUserId": null,
        "auditTrail": null,
        "jobId": "850dc7d2-5240-437f-9bcd-b1ed7dc339c2",
        "templateId": "262fccc5-cae9-4258-b522-540c4010e0a9",
        "userId": "16807000",
        "aLaCarte": true,
        "msoRequestId": "c0011670-0e1a-4b74-945d-8bf5aede1d45",
        "jobStatus": "IN_PROGRESS",
        "statusModifiedDate": 1524663233000,
        "hidden": false,
        "pause": false,
        "owningEntityId": "d61e6f2d-12fa-4cc2-91df-7c244011d6fc",
        "owningEntityName": "WayneHolland",
        "project": "WATKINS",
        "aicZoneId": "NFT1",
        "aicZoneName": "NFTJSSSS-NFT1",
        "tenantId": "bae71557c5bb4d5aac6743a4e5f1d054",
        "tenantName": "AIN Web Tool-15-D-testalexandria",
        "regionId": "hvf6",
        "regionName": null,
        "serviceType": "TYLER SILVIA",
        "subscriberName": "e433710f-9217-458d-a79d-1c7aff376d89",
        "serviceInstanceId": null,
        "serviceInstanceName": "sPenLiZXXpqzsVck instance name_01",
        "serviceModelId": "e49fbd11-e60c-4a8e-b4bf-30fbe8f4fcc0",
        "serviceModelName": "action-data",
        "serviceModelVersion": "1.0",
        "createdBulkDate": 1524663233000,
        "isRetryEnabled": false
      },
      {
        "id": 10,
        "created": 1524663233000,
        "modified": 1524663236000,
        "action": "UPDATE",
        "createdId": null,
        "modifiedId": null,
        "rowNum": null,
        "auditUserId": null,
        "auditTrail": null,
        "jobId": "850dc7d2-5240-437f-9bcd-b1ed7dc339c1",
        "templateId": "262fccc5-cae9-4258-b522-540c4010e0a9",
        "userId": "16807000",
        "aLaCarte": true,
        "msoRequestId": "c0011670-0e1a-4b74-945d-8bf5aede1d45",
        "jobStatus": "COMPLETED",
        "statusModifiedDate": 1524663233000,
        "hidden": false,
        "pause": false,
        "owningEntityId": "d61e6f2d-12fa-4cc2-91df-7c244011d6fc",
        "owningEntityName": "WayneHolland",
        "project": "WATKINS",
        "aicZoneId": "NFT1",
        "aicZoneName": "NFTJSSSS-NFT1",
        "tenantId": "bae71557c5bb4d5aac6743a4e5f1d054",
        "tenantName": "AIN Web Tool-15-D-testalexandria",
        "regionId": "hvf6",
        "regionName": null,
        "serviceType": "TYLER SILVIA",
        "subscriberName": "e433710f-9217-458d-a79d-1c7aff376d89",
        "serviceInstanceId": null,
        "serviceInstanceName": "sPenLiZXXpqzsVck instance name_01",
        "serviceModelId": "e49fbd11-e60c-4a8e-b4bf-30fbe8f4fcc0",
        "serviceModelName": "action-data",
        "serviceModelVersion": "1.0",
        "createdBulkDate": 1524663233000
      }
    ];

    cy.route(Cypress.config('baseUrl') + "/asyncInstantiation**", asyncInstantiation);

    cy.openIframe('/app/ui/#/servicePopup?serviceModelId=2f80c596-27e5-4ca9-b5bb-e03a7fd4c0fd&isCreate=true');
    cy.getElementByDataTestsId('templateButton').contains('Template')
      .getElementByDataTestsId('templateButton').click({force: true}) // Open template Modal
      .getElementByDataTestsId('template-modal-title').contains('Templates') // Check Modal header
      .getElementByDataTestsId('description-part-1').contains('The following list presents previous instantiations done for this model in this version.')
      .getElementByDataTestsId('description-part-2').contains('You may use one of them as a baseline for your instantiation or start from scratch.')
      .getElementByDataTestsId('description-part-3').contains('Once you selecting one allows you to change the data before start instantiating.')


    //check table headers
    cy.get(`#header-userId`).contains('User ID');
    cy.get(`#header-createDate`).contains('Date');
    cy.get(`#header-instanceName`).contains('Instance Name');
    cy.get(`#header-instantiationStatus`).contains('Instantiation Status');
    cy.get(`#header-region`).contains('Region');
    cy.get(`#header-tenant`).contains('Tenant');
    cy.get(`#header-aicZone`).contains('AIC Zone');

    // check table body row
    cy.getElementByDataTestsId(`userId-${asyncInstantiation[0].jobId}`).contains('16807000');
    cy.getElementByDataTestsId(`createDate-${asyncInstantiation[0].jobId}`).contains('2018-04-30 11:12:48');
    cy.getElementByDataTestsId(`instanceName-${asyncInstantiation[0].jobId}`).contains('nWUfl instance name_002');
    cy.getElementByDataTestsId(`instantiationStatus-${asyncInstantiation[0].jobId}`).contains('FAILED');
    cy.getElementByDataTestsId(`region-${asyncInstantiation[0].jobId}`).contains('hvf6 (WAYNEHOLLAND)');
    cy.getElementByDataTestsId(`tenant-${asyncInstantiation[0].jobId}`).contains('AIN Web Tool-15-D-testalexandria');
    cy.getElementByDataTestsId(`aicZone-${asyncInstantiation[0].jobId}`).contains('NFTJSSSS-NFT1');


    //check load button is disabled
    cy.getElementByDataTestsId('LoadTemplateButton').should('be.disabled')
    cy.getElementByDataTestsId('row-850dc7d2-5240-437f-9bcd-b1ed7dc339ca').click();
    cy.getElementByDataTestsId('LoadTemplateButton').should('not.be.disabled')

  });
});

